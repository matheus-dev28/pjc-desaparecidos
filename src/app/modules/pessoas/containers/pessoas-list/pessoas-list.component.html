<section class="bg-[url('assets/banner/desaparecidos.png')] bg-cover">
  <div class="flex flex-col-reverse md:flex-row items-center md:items-center justify-between gap-4 md:gap-0 w-full max-w-[1200px] 2xl:max-w-[1440px] mx-auto">
    <app-pessoas-search class="p-4 md:p-6 w-full md:w-auto" (filtroChange)="onFiltro($event)"></app-pessoas-search>

    <div class="flex gap-8 md:gap-24 text-white pr-0 md:pr-32" *ngIf="estatistica$ | async as estatistica">
      <div class="flex flex-col items-center">
        <span class="uppercase text-xl font-bold">desaparecidos</span>
        <span class="text-4xl font-bold">{{ estatistica.quantPessoasDesaparecidas }}</span>
      </div>
      <div class="flex flex-col items-center">
        <span class="uppercase text-xl font-bold">localizados</span>
        <span class="text-4xl font-bold">{{ estatistica.quantPessoasEncontradas }}</span>
      </div>
    </div>
  </div>
</section>

<section class="bg-gray-100">
  <div class="w-full max-w-[1200px] 2xl:max-w-[1440px] mx-auto p-6 md:p-8">
    <h3 class="text-center text-blue-950 mb-6">Listagem de Desaparecidos</h3>

    <ng-container *ngIf="page$ | async as page">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" *ngIf="page.content?.length; else empty">
        <a
          *ngFor="let p of page.content; trackBy: trackById"
          class="block bg-white rounded-xl shadow transition p-4 hover:shadow-md"
          [routerLink]="['/pessoa', p.id]">
          <div class="flex gap-4">
            <img
              [src]="p.urlFoto || 'assets/images/desconhecido.png'"
              alt="{{ p.nome }}"
              class="w-40 h-52 object-cover rounded-lg"
              loading="lazy"
              decoding="async"
              width="160"
              height="176"
              (error)="onImgError($event)" />
            <div class="flex-1">
              <div class="font-semibold text-gray-900">{{ p.nome }}</div>
              <div class="text-sm text-gray-600">
                <span *ngIf="p.idade !== undefined">{{ p.idade }} anos · </span>
                <span *ngIf="p.sexo">{{ p.sexo === 'MASCULINO' ? 'Masculino' : 'Feminino' }}</span>
              </div>
              <div class="mt-2 text-sm text-gray-500">
                {{ p.ultimaOcorrencia?.localDesaparecimentoConcat || 'Local não informado' }}
              </div>

              <div class="mt-2 text-xs text-gray-500">
                Desapareceu em {{ p.ultimaOcorrencia?.dtDesaparecimento | date:'dd/MM/yyyy, HH:mm' }}
              </div>
              <div class="mt-1 text-xs text-gray-500" *ngIf="p.ultimaOcorrencia?.dataLocalizacao">
                Localizado em {{ p.ultimaOcorrencia?.dataLocalizacao | date:'dd/MM/yyyy, HH:mm' }}
              </div>

              <div class="mt-3">
                <span class="px-2 py-0.5 rounded text-sm font-medium"
                  [class.bg-red-100]="!p.ultimaOcorrencia?.dataLocalizacao"
                  [class.text-red-700]="!p.ultimaOcorrencia?.dataLocalizacao"
                  [class.bg-green-100]="p.ultimaOcorrencia?.dataLocalizacao"
                  [class.text-green-700]="p.ultimaOcorrencia?.dataLocalizacao">
                  {{ p.ultimaOcorrencia?.dataLocalizacao ? 'LOCALIZADO' : 'DESAPARECIDO' }}
                </span>
              </div>
            </div>
          </div>
        </a>
      </div>

      <ng-template #empty>
        <div class="text-center text-gray-600 py-20">Nenhum registro encontrado.</div>
      </ng-template>

      <div class="mt-6 bg-white rounded-xl p-2">
        <mat-paginator
          [length]="page.totalElements || 0"
          [pageIndex]="page.number || 0"
          [pageSize]="page.size || 12"
          [pageSizeOptions]="[12, 40, 100]"
          (page)="onPage($event)">
        </mat-paginator>
      </div>
    </ng-container>
  </div>
</section>
